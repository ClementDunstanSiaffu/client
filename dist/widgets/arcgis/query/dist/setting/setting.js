System.register(["jimu-core","jimu-for-builder","jimu-ui/advanced/data-source-selector","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/basic/list-tree","jimu-theme","jimu-ui/advanced/resource-selector","jimu-ui/advanced/sql-expression-builder","jimu-ui/basic/sql-expression-runtime","jimu-ui/advanced/expression-builder"],(function(e,t){var a={},i={},l={},s={},o={},n={},r={},c={},u={},d={},p={};return{setters:[function(e){a.CONSTANTS=e.CONSTANTS,a.DataSourceComponent=e.DataSourceComponent,a.DataSourceManager=e.DataSourceManager,a.DataSourceStatus=e.DataSourceStatus,a.DataSourceTypes=e.DataSourceTypes,a.Immutable=e.Immutable,a.React=e.React,a.ReactRedux=e.ReactRedux,a.appConfigUtils=e.appConfigUtils,a.classNames=e.classNames,a.css=e.css,a.dataSourceUtils=e.dataSourceUtils,a.getAppStore=e.getAppStore,a.jsx=e.jsx,a.polished=e.polished,a.urlUtils=e.urlUtils},function(e){i.getAppConfigAction=e.getAppConfigAction},function(e){l.AllDataSourceTypes=e.AllDataSourceTypes,l.DataSourceRemoveWaringReason=e.DataSourceRemoveWaringReason,l.DataSourceRemoveWarningPopup=e.DataSourceRemoveWarningPopup,l.DataSourceSelector=e.DataSourceSelector,l.FieldSelector=e.FieldSelector,l.dataComponentsUtils=e.dataComponentsUtils},function(e){s.Button=e.Button,s.ButtonGroup=e.ButtonGroup,s.Checkbox=e.Checkbox,s.Collapse=e.Collapse,s.Icon=e.Icon,s.Modal=e.Modal,s.ModalBody=e.ModalBody,s.ModalFooter=e.ModalFooter,s.MultiSelect=e.MultiSelect,s.NumericInput=e.NumericInput,s.PanelHeader=e.PanelHeader,s.Popper=e.Popper,s.SVG=e.SVG,s.Select=e.Select,s.Switch=e.Switch,s.TextArea=e.TextArea,s.TextInput=e.TextInput,s.Tooltip=e.Tooltip,s.getFallbackPlacementsModifier=e.getFallbackPlacementsModifier,s.hooks=e.hooks},function(e){o.DirectionSelector=e.DirectionSelector,o.MapWidgetSelector=e.MapWidgetSelector,o.SettingCollapse=e.SettingCollapse,o.SettingRow=e.SettingRow,o.SettingSection=e.SettingSection,o.SidePopper=e.SidePopper},function(e){n.List=e.List,n.TreeItemActionType=e.TreeItemActionType},function(e){r.withTheme=e.withTheme},function(e){c.IconPicker=e.IconPicker},function(e){u.Sort=e.Sort,u.SqlExpressionBuilderPopup=e.SqlExpressionBuilderPopup},function(e){d.getJimuFieldNamesBySqlExpression=e.getJimuFieldNamesBySqlExpression},function(e){p.ExpressionBuilder=e.ExpressionBuilder,p.ExpressionBuilderType=e.ExpressionBuilderType}],execute:function(){e((()=>{var e={41572:e=>{e.exports='<svg viewBox="0 0 16 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.467 0h1.066v2H7.467V0ZM14.308 2l.755.707-1.509 1.414-.754-.707L14.308 2ZM13.867 7H16v1h-2.133V7ZM1.82 2l-.753.707 1.508 1.414.754-.707L1.821 2ZM0 7v1h2.133V7H0Z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M12.8 7.5c0 1.56-.847 2.935-2.133 3.742V14H5.333v-2.758C4.047 10.435 3.2 9.06 3.2 7.5 3.2 5.015 5.349 3 8 3s4.8 2.015 4.8 4.5Zm-2.727 2.911-.473.297V13H6.4v-2.292l-.473-.297c-1.004-.63-1.66-1.698-1.66-2.911C4.267 5.567 5.938 4 8 4c2.062 0 3.733 1.567 3.733 3.5 0 1.213-.657 2.282-1.66 2.911Z" fill="#000"></path></svg>'},748:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5Zm-9 0a3.501 3.501 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5ZM15.5 11l-5 1-3 4-1-9.5 9 4.5Zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38-2.517.503Z" fill="#000"></path></svg>'},41553:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.438.994c.213 0 .397.146.44.35.151.722.257 1.34.316 1.852.374.16.725.362 1.048.599l1.728-.676a.455.455 0 0 1 .556.188l1.42 2.394a.43.43 0 0 1-.091.547 21.98 21.98 0 0 1-1.49 1.194 5.17 5.17 0 0 1-.007 1.183l1.464 1.119a.43.43 0 0 1 .111.563l-1.42 2.394a.454.454 0 0 1-.53.197 22.445 22.445 0 0 1-1.807-.66c-.325.233-.679.43-1.055.586l-.263 1.794a.446.446 0 0 1-.445.376H6.574a.446.446 0 0 1-.44-.35 21.019 21.019 0 0 1-.317-1.853 5.34 5.34 0 0 1-1.047-.598l-1.728.675a.455.455 0 0 1-.556-.187l-1.42-2.395a.43.43 0 0 1 .091-.546c.567-.49 1.063-.888 1.49-1.194a5.167 5.167 0 0 1 .008-1.183L1.19 6.243a.43.43 0 0 1-.112-.562l1.42-2.395a.455.455 0 0 1 .531-.196c.719.233 1.321.453 1.807.66.324-.233.679-.43 1.056-.587l.262-1.794A.446.446 0 0 1 6.6.994h2.839Zm-.365 1H6.985l-.28 1.866-.467.19c-.235.095-.46.21-.672.34l-.207.136-.42.293-.476-.197c-.328-.137-.718-.281-1.169-.433l-.221-.074-1.045 1.719L3.59 6.999l-.06.479a4.127 4.127 0 0 0-.021.816l.014.144.058.492-.419.294c-.288.203-.615.451-.979.746l-.177.145 1.043 1.72 1.845-.703.406.29c.204.146.42.274.645.384l.228.103.474.199.059.49c.04.338.103.731.19 1.177l.043.219h2.088l.282-1.867.466-.19c.236-.095.46-.21.672-.34l.207-.136.419-.293.476.198c.33.136.72.28 1.17.433l.22.072 1.044-1.718-1.56-1.165.06-.479a4.131 4.131 0 0 0 .02-.815l-.013-.144-.06-.492.42-.295a18.1 18.1 0 0 0 .98-.746l.176-.146-1.043-1.72-1.844.705-.406-.29a4.496 4.496 0 0 0-.646-.385l-.228-.103-.474-.199-.058-.49c-.032-.27-.08-.576-.14-.916l-.094-.48Zm-1.067 3a3 3 0 1 1 0 6 3 3 0 0 1 0-6Zm0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4Z" fill="#000"></path></svg>'},2534:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M15 3.5v9c0 1.933-3.134 3.5-7 3.5s-7-1.567-7-3.5v-9C1 1.567 4.134 0 8 0s7 1.567 7 3.5ZM2 5.304V6.5C2 7.692 4.615 9 8 9s6-1.308 6-2.5V5.304C12.775 6.32 10.546 7 8 7s-4.775-.68-6-1.696ZM8 10c2.546 0 4.775-.68 6-1.696V9.5c0 1.192-2.615 2.5-6 2.5s-6-1.308-6-2.5V8.304C3.225 9.32 5.454 10 8 10Zm6 1.304C12.775 12.32 10.546 13 8 13s-4.775-.68-6-1.696V12.5C2 13.692 4.615 15 8 15s6-1.308 6-2.5v-1.196ZM14 3.5C14 4.692 11.385 6 8 6S2 4.692 2 3.5 4.615 1 8 1s6 1.308 6 2.5Z" fill="#000"></path></svg>'},33869:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15 7.5a.522.522 0 0 1-.516.527H2.976L6.473 11.6a.535.535 0 0 1 0 .746.508.508 0 0 1-.73 0L1 7.5l4.743-4.846a.508.508 0 0 1 .73 0 .535.535 0 0 1 0 .746L2.976 6.973h11.508c.285 0 .516.236.516.527Z" fill="#000"></path></svg>'},59788:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .538.538 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.538.538 0 0 1 0-.738Z" fill="#000"></path></svg>'},3273:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.653 13.854a.485.485 0 0 1 0-.708L10.24 8 4.653 2.854a.485.485 0 0 1 0-.708.538.538 0 0 1 .738 0l5.956 5.5a.485.485 0 0 1 0 .708l-5.956 5.5a.538.538 0 0 1-.738 0Z" fill="#000"></path></svg>'},96009:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .538.538 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.538.538 0 0 1 0 .738Z" fill="#000"></path></svg>'},55339:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746L8.746 8Z" fill="#000"></path></svg>'},34750:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.5 0a.5.5 0 0 0-.5.5V7H.5a.5.5 0 0 0 0 1H7v6.5a.5.5 0 0 0 1 0V8h6.5a.5.5 0 0 0 0-1H8V.5a.5.5 0 0 0-.5-.5Z" fill="#000"></path></svg>'},86567:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm1 0a7 7 0 0 0 7 7 7.009 7.009 0 0 0 7-7A7 7 0 1 0 1 8Z" fill="#000"></path></svg>'},29786:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M7 2h2a2 2 0 0 1 2 2v7.817l-3 2.812-3-2.812V4a2 2 0 0 1 2-2Zm5 2v8.25L8 16l-4-3.75V4a3 3 0 0 1 3-3h2a3 3 0 0 1 3 3ZM9 6a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm1 0a2 2 0 1 1-4 0 2 2 0 0 1 4 0Z" fill="#000"></path></svg>'},87783:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 3.429V16h14V0L6.833 6.857 1 3.43ZM14 2v13H2V5.114l4.182 2.51a1.2 1.2 0 0 0 1.398-.118L14 2Z" fill="#000"></path></svg>'},43126:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.582 5 11 10.949V12H9v-1.274L5.316 7h-.515L2 12.383V14H0v-2h1.073L4 6.374V5h2v1.27L9.688 10h.716L14 4.029V3h2v2h-1.418Z" fill="#000"></path></svg>'},45859:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.002 1H14a1 1 0 0 1 1 1.002v11.997A1 1 0 0 1 14 15H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1.002-1ZM2 14h12V2H2v12Z" fill="#000"></path></svg>'},79964:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 2.125 14.334 14H1.667L8 2.125Zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47L7.118 1.653ZM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995Zm1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z" fill="#000"></path></svg>'},94539:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 4.796 4.796 4 8.02 7.224l3.184-3.184.796.796L8.816 8.02l3.144 3.144-.796.796L8.02 8.816 4.836 12l-.796-.796L7.224 8.02 4 4.796Z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="m0 4 4-4h8l4 4v8l-4 4H4l-4-4V4Zm1 .414L4.414 1h7.172L15 4.414v7.172L11.586 15H4.414L1 11.586V4.414Z" fill="#000"></path></svg>'},9190:e=>{e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxzdmcgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiB2aWV3Qm94PSIwIDAgMTYgMTYiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+DQogICAgPHBhdGggZD0iTTE0LjQxNzIgMEgwVjEyLjg4ODNINS42MDY3MVYxMi4wODI3SDAuODAwOTU4VjAuODA1NTE2SDEzLjYxNjNWNi4wNDEzN0gxNC40MTcyVjBaIiBmaWxsPSJ3aGl0ZSIvPg0KICAgIDxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMTAuNDEyNSAxNC45MDIxQzExLjUwNzggMTQuOTAyMSAxMi41MDk4IDE0LjUwMDEgMTMuMjgwNCAxMy44MzQ2TDE1LjQzMzYgMTZMMTYgMTUuNDMwNUwxMy44Mzg2IDEzLjI1NjhDMTQuNDUwOSAxMi40OTU5IDE0LjgxNzcgMTEuNTI2OCAxNC44MTc3IDEwLjQ3MTdDMTQuODE3NyA4LjAyNDg4IDEyLjg0NTQgNi4wNDEzNyAxMC40MTI1IDYuMDQxMzdDNy45Nzk1MiA2LjA0MTM3IDYuMDA3MTkgOC4wMjQ4OCA2LjAwNzE5IDEwLjQ3MTdDNi4wMDcxOSAxMi45MTg1IDcuOTc5NTIgMTQuOTAyMSAxMC40MTI1IDE0LjkwMjFaTTEwLjQxMjUgMTQuMDk2NUMxMi40MDMxIDE0LjA5NjUgMTQuMDE2OCAxMi40NzM3IDE0LjAxNjggMTAuNDcxN0MxNC4wMTY4IDguNDY5NzIgMTIuNDAzMSA2Ljg0Njg5IDEwLjQxMjUgNi44NDY4OUM4LjQyMTg0IDYuODQ2ODkgNi44MDgxNCA4LjQ2OTcyIDYuODA4MTQgMTAuNDcxN0M2LjgwODE0IDEyLjQ3MzcgOC40MjE4NCAxNC4wOTY1IDEwLjQxMjUgMTQuMDk2NVoiIGZpbGw9IndoaXRlIi8+DQogICAgPHBhdGggZD0iTTIuNDAyODcgMi40MTY1NUgxMi4wMTQ0VjMuMjIyMDdIMi40MDI4N1YyLjQxNjU1WiIgZmlsbD0id2hpdGUiLz4NCiAgICA8cGF0aCBkPSJNNy4yMDg2MiA0LjgzMzFIMi40MDI4N1Y1LjYzODYxSDcuMjA4NjJWNC44MzMxWiIgZmlsbD0id2hpdGUiLz4NCiAgICA8cGF0aCBkPSJNMi40MDI4NyA3LjI0OTY1SDQuODA1NzVWOC4wNTUxNkgyLjQwMjg3VjcuMjQ5NjVaIiBmaWxsPSJ3aGl0ZSIvPg0KICAgIDxwYXRoIGQ9Ik00LjgwNTc1IDkuNjY2MkgyLjQwMjg3VjEwLjQ3MTdINC44MDU3NVY5LjY2NjJaIiBmaWxsPSJ3aGl0ZSIvPg0KPC9zdmc+DQo="},6650:e=>{e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxzdmcgd2lkdGg9IjY4IiBoZWlnaHQ9IjY4IiB2aWV3Qm94PSIwIDAgNjggNjgiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+DQo8cmVjdCB4PSI0IiB5PSI0IiB3aWR0aD0iNjAiIGhlaWdodD0iMTUiIHJ4PSIxIiBmaWxsPSIjMjgyODI4Ii8+DQo8cmVjdCB4PSI4IiB5PSI4IiB3aWR0aD0iMTUiIGhlaWdodD0iOCIgcng9IjIiIGZpbGw9IiM2QTZBNkEiLz4NCjxyZWN0IHg9IjI1IiB5PSI4IiB3aWR0aD0iMTkiIGhlaWdodD0iOCIgcng9IjIiIGZpbGw9IiM1MjUyNTIiLz4NCjxwYXRoIGQ9Ik00IDI0LjEyNzRDNCAyMy41NzUyIDQuNDQ3NzIgMjMuMTI3NCA1IDIzLjEyNzRINDdDNDcuNTUyMyAyMy4xMjc0IDQ4IDIzLjU3NTIgNDggMjQuMTI3NFY2M0M0OCA2My41NTIzIDQ3LjU1MjMgNjQgNDcgNjRINUM0LjQ0NzcxIDY0IDQgNjMuNTUyMyA0IDYzVjI0LjEyNzRaIiBmaWxsPSIjMzYzNjM2Ii8+DQo8cmVjdCB4PSI4IiB5PSIyNiIgd2lkdGg9IjIxIiBoZWlnaHQ9IjQiIHJ4PSIxIiBmaWxsPSIjNkE2QTZBIi8+DQo8cGF0aCBkPSJNNDEuNzA3MSAyNkw0MSAyNi43MDcxTDQyLjQxNDIgMjguMTIxM0w0MSAyOS41MzU1TDQxLjcwNzEgMzAuMjQyNkw0My4xMjEzIDI4LjgyODRMNDQuNTM1NSAzMC4yNDI2TDQ1LjI0MjYgMjkuNTM1NUw0My44Mjg0IDI4LjEyMTNMNDUuMjQyNiAyNi43MDcxTDQ0LjUzNTUgMjZMNDMuMTIxMyAyNy40MTQyTDQxLjcwNzEgMjZaIiBmaWxsPSIjNTI1MjUyIi8+DQo8cmVjdCB4PSI4IiB5PSIzNSIgd2lkdGg9IjM2IiBoZWlnaHQ9IjMiIGZpbGw9IiM1MjUyNTIiLz4NCjxyZWN0IHg9IjgiIHk9IjQyIiB3aWR0aD0iMzYiIGhlaWdodD0iMyIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iOCIgeT0iNDkiIHdpZHRoPSIzNiIgaGVpZ2h0PSIzIiBmaWxsPSIjNTI1MjUyIi8+DQo8cmVjdCB4PSI4IiB5PSI1NiIgd2lkdGg9IjI5IiBoZWlnaHQ9IjMiIGZpbGw9IiM1MjUyNTIiLz4NCjxyZWN0IHg9IjQ2IiB5PSI4IiB3aWR0aD0iMTQiIGhlaWdodD0iOCIgcng9IjIiIGZpbGw9IiM1MjUyNTIiLz4NCjwvc3ZnPg0K"},37083:e=>{e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxzdmcgd2lkdGg9IjY4IiBoZWlnaHQ9IjY4IiB2aWV3Qm94PSIwIDAgNjggNjgiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+DQo8cmVjdCB4PSI0IiB5PSI0IiB3aWR0aD0iOCIgaGVpZ2h0PSI4IiByeD0iMiIgZmlsbD0iIzZBNkE2QSIvPg0KPHBhdGggZD0iTTQgMTZDNCAxNS40NDc3IDQuNDQ3NzIgMTUgNSAxNUg2M0M2My41NTIzIDE1IDY0IDE1LjQ0NzcgNjQgMTZWNjNDNjQgNjMuNTUyMyA2My41NTIzIDY0IDYzIDY0SDVDNC40NDc3MSA2NCA0IDYzLjU1MjMgNCA2M1YxNloiIGZpbGw9IiMyODI4MjgiLz4NCjxyZWN0IHg9IjgiIHk9IjE5IiB3aWR0aD0iMjEiIGhlaWdodD0iNCIgcng9IjEiIGZpbGw9IiM2QTZBNkEiLz4NCjxwYXRoIGQ9Ik01NS43MDcxIDE5TDU1IDE5LjcwNzFMNTYuNDE0MiAyMS4xMjEzTDU1IDIyLjUzNTVMNTUuNzA3MSAyMy4yNDI2TDU3LjEyMTMgMjEuODI4NEw1OC41MzU1IDIzLjI0MjZMNTkuMjQyNiAyMi41MzU1TDU3LjgyODQgMjEuMTIxM0w1OS4yNDI2IDE5LjcwNzFMNTguNTM1NSAxOUw1Ny4xMjEzIDIwLjQxNDJMNTUuNzA3MSAxOVoiIGZpbGw9IiM1MjUyNTIiLz4NCjxyZWN0IHg9IjgiIHk9IjI5IiB3aWR0aD0iNTIiIGhlaWdodD0iOCIgcng9IjEiIGZpbGw9IiMzNjM2MzYiLz4NCjxyZWN0IHg9IjEwIiB5PSIzMSIgd2lkdGg9IjI2IiBoZWlnaHQ9IjQiIHJ4PSIxIiBmaWxsPSIjNkE2QTZBIi8+DQo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTU2LjY0NjQgMzNMNTUgMzEuMzUzNkw1NS43MDcxIDMwLjY0NjVMNTguMDYwNyAzM0w1NS43MDcxIDM1LjM1MzZMNTUgMzQuNjQ2NUw1Ni42NDY0IDMzWiIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iOCIgeT0iNDAiIHdpZHRoPSI1MiIgaGVpZ2h0PSI4IiByeD0iMSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTAiIHk9IjQyIiB3aWR0aD0iMjYiIGhlaWdodD0iNCIgcng9IjEiIGZpbGw9IiM2QTZBNkEiLz4NCjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNNTYuNjQ2NCA0NEw1NSA0Mi4zNTM2TDU1LjcwNzEgNDEuNjQ2NUw1OC4wNjA3IDQ0TDU1LjcwNzEgNDYuMzUzNkw1NSA0NS42NDY1TDU2LjY0NjQgNDRaIiBmaWxsPSIjNTI1MjUyIi8+DQo8cmVjdCB4PSI4IiB5PSI1MSIgd2lkdGg9IjUyIiBoZWlnaHQ9IjgiIHJ4PSIxIiBmaWxsPSIjMzYzNjM2Ii8+DQo8cmVjdCB4PSIxMCIgeT0iNTMiIHdpZHRoPSIyNiIgaGVpZ2h0PSI0IiByeD0iMSIgZmlsbD0iIzZBNkE2QSIvPg0KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik01Ni42NDY0IDU1TDU1IDUzLjM1MzZMNTUuNzA3MSA1Mi42NDY1TDU4LjA2MDcgNTVMNTUuNzA3MSA1Ny4zNTM2TDU1IDU2LjY0NjVMNTYuNjQ2NCA1NVoiIGZpbGw9IiM1MjUyNTIiLz4NCjwvc3ZnPg0K"},1463:e=>{e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxzdmcgd2lkdGg9IjY4IiBoZWlnaHQ9IjY4IiB2aWV3Qm94PSIwIDAgNjggNjgiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+DQo8cmVjdCB4PSI0IiB5PSI0IiB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHJ4PSIxIiBmaWxsPSIjMjgyODI4Ii8+DQo8cmVjdCB4PSI4IiB5PSI4IiB3aWR0aD0iNTIiIGhlaWdodD0iOCIgcng9IjEiIGZpbGw9IiMzNjM2MzYiLz4NCjxyZWN0IHg9IjEwIiB5PSIxMCIgd2lkdGg9IjI2IiBoZWlnaHQ9IjQiIHJ4PSIxIiBmaWxsPSIjNkE2QTZBIi8+DQo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTU2LjY0NjQgMTJMNTUgMTAuMzUzNkw1NS43MDcxIDkuNjQ2NDhMNTguMDYwNyAxMkw1NS43MDcxIDE0LjM1MzZMNTUgMTMuNjQ2NUw1Ni42NDY0IDEyWiIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iOCIgeT0iMTkiIHdpZHRoPSI1MiIgaGVpZ2h0PSI4IiByeD0iMSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTAiIHk9IjIxIiB3aWR0aD0iMjYiIGhlaWdodD0iNCIgcng9IjEiIGZpbGw9IiM2QTZBNkEiLz4NCjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNNTYuNjQ2NCAyM0w1NSAyMS4zNTM2TDU1LjcwNzEgMjAuNjQ2NUw1OC4wNjA3IDIzTDU1LjcwNzEgMjUuMzUzNkw1NSAyNC42NDY1TDU2LjY0NjQgMjNaIiBmaWxsPSIjNTI1MjUyIi8+DQo8cmVjdCB4PSI4IiB5PSIzMCIgd2lkdGg9IjUyIiBoZWlnaHQ9IjgiIHJ4PSIxIiBmaWxsPSIjMzYzNjM2Ii8+DQo8cmVjdCB4PSIxMCIgeT0iMzIiIHdpZHRoPSIyNiIgaGVpZ2h0PSI0IiByeD0iMSIgZmlsbD0iIzZBNkE2QSIvPg0KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik01Ni42NDY0IDM0TDU1IDMyLjM1MzZMNTUuNzA3MSAzMS42NDY1TDU4LjA2MDcgMzRMNTUuNzA3MSAzNi4zNTM2TDU1IDM1LjY0NjVMNTYuNjQ2NCAzNFoiIGZpbGw9IiM1MjUyNTIiLz4NCjxyZWN0IHg9IjgiIHk9IjQxIiB3aWR0aD0iNTIiIGhlaWdodD0iOCIgcng9IjEiIGZpbGw9IiMzNjM2MzYiLz4NCjxyZWN0IHg9IjEwIiB5PSI0MyIgd2lkdGg9IjI2IiBoZWlnaHQ9IjQiIHJ4PSIxIiBmaWxsPSIjNkE2QTZBIi8+DQo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTU2LjY0NjQgNDVMNTUgNDMuMzUzNkw1NS43MDcxIDQyLjY0NjVMNTguMDYwNyA0NUw1NS43MDcxIDQ3LjM1MzZMNTUgNDYuNjQ2NUw1Ni42NDY0IDQ1WiIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iOCIgeT0iNTIiIHdpZHRoPSI1MiIgaGVpZ2h0PSI4IiByeD0iMSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTAiIHk9IjU0IiB3aWR0aD0iMjYiIGhlaWdodD0iNCIgcng9IjEiIGZpbGw9IiM2QTZBNkEiLz4NCjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNNTYuNjQ2NCA1Nkw1NSA1NC4zNTM2TDU1LjcwNzEgNTMuNjQ2NUw1OC4wNjA3IDU2TDU1LjcwNzEgNTguMzUzNkw1NSA1Ny42NDY1TDU2LjY0NjQgNTZaIiBmaWxsPSIjNTI1MjUyIi8+DQo8L3N2Zz4NCg=="},48891:e=>{"use strict";e.exports=a},23137:e=>{"use strict";e.exports=i},34796:e=>{"use strict";e.exports=r},30726:e=>{"use strict";e.exports=s},338:e=>{"use strict";e.exports=l},39342:e=>{"use strict";e.exports=p},20663:e=>{"use strict";e.exports=c},77756:e=>{"use strict";e.exports=o},43484:e=>{"use strict";e.exports=u},59587:e=>{"use strict";e.exports=n},15506:e=>{"use strict";e.exports=d}},t={};function g(a){var i=t[a];if(void 0!==i)return i.exports;var l=t[a]={exports:{}};return e[a](l,l.exports,g),l.exports}g.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return g.d(t,{a:t}),t},g.d=(e,t)=>{for(var a in t)g.o(t,a)&&!g.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},g.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),g.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},g.p="";var I={};return g.p=window.jimuConfig.baseUrl,(()=>{"use strict";g.r(I),g.d(I,{default:()=>Ue});var e,t,a,i,l,s,o,n,r,c,u,d=g(48891),p=g(23137),m=g(338),S=g(30726),y=g(77756);!function(e){e.Point="Point",e.Polyline="Polyline",e.Polygon="Polygon",e.Rectangle="Rectangle",e.Circle="Circle"}(e||(e={})),function(e){e.NewSelection="NEW_SELECTION",e.AddToSelection="ADD_TO_CURRENT_SELECTION",e.RemoveFromSelection="REMOVE_FROM_CURRENT_SELECTION",e.SubsetSelection="SUBSET_FROM_CURRENT_SELECTION",e.SwitchSelction="SWITCH_CURRENT_SELECTION"}(t||(t={})),function(e){e.Block="BLOCK",e.Inline="INLINE",e.Popper="POPPER"}(a||(a={})),function(e){e.CurrentMapExtent="CurrentMapExtent",e.InteractiveDrawMode="InteractiveDrawMode",e.None=""}(i||(i={})),function(e){e.Intersect="intersects",e.Contain="contains",e.Cross="crosses",e.EnvelopeIntersect="envelope-intersects",e.IndexIntersect="index-intersects",e.Overlap="overlaps",e.Touch="touches",e.Within="within"}(l||(l={})),l.Intersect,l.Contain,l.Cross,l.EnvelopeIntersect,l.IndexIntersect,l.Overlap,l.Touch,l.Within,function(e){e.Miles="Miles",e.Kilometers="Kilometers",e.Feet="Feet",e.Meters="Meters",e.NauticalMiles="NauticalMiles"}(s||(s={})),s.Miles,s.Kilometers,s.Feet,s.Meters,s.NauticalMiles,function(e){e.Horizontal="Horizontal",e.Vertical="Vertical"}(o||(o={})),function(e){e.MultiPage="MultiPage",e.LazyLoad="LazyLoad"}(n||(n={})),function(e){e.PopupSetting="PopupSetting",e.SelectAttributes="SelectAttributes"}(r||(r={})),function(e){e.Asc="Asc",e.Desc="Desc"}(c||(c={})),function(e){e.DefaultSymbol="DefaultSymbol",e.CustomSymbol="CustomSymbol"}(u||(u={}));const j={queryItem:"Query item",outputDsLabel:"{label} result",addNewQueryAndCustomOptions:"Add new query and custom options.",newQuery:"New query",newFilterLayer:"Add filter layer",arrangementStyle:"Arrangement style",wrapItems:"Wrap items",relationship:"Relationship",spatialRelation_Intersect:"Intersect",spatialRelation_Contain:"Contain",spatialRelation_Cross:"Cross",spatialRelation_EnvelopeIntersect:"Envelope Intersect",spatialRelation_IndexIntersect:"Index Intersect",spatialRelation_Overlap:"Overlap",spatialRelation_Touch:"Touch",spatialRelation_Within:"Within",setQuery:"Set query",attributeFilter:"Attribute filter",addSQLExpressionsToYourQuery:"Add SQL expressions to your query",pleaseAddYourSQLExpressionsFirst:"Please add your SQL expressions first.",spatialFilter:"Spatial filter",mapRequirement_MapNotRequired:"Map widget not required ",mapRequirement_MapIsRequired:"Requires a Map widget",typesOfFilter:"Filter by",featureFromDs:"Selected features from data source",featureFromMap:"Geometries from a map",selectionViewOnly:"Support selected features view only",geometryTypes:"Geometry types",spatialFilterType_CurrentMapExtent:"Current map extent",spatialFilterType_InteractiveDrawMode:"Drawn graphic",spatialFilterType_SpatialRelationship:"Use other layers",results:"Results",listDirection:"List direction",pagingStyle:"Paging Style",pagingStyle_MultiPage:"Multipage",pagingStyle_LazyLoad:"Single-page",field_PopupSetting:"Use webmap settings",field_SelectAttributes:"Customize",selectDisplayFields:"Select fields to display ",symbolType_DefaultSymbol:"Default",symbolType_CustomSymbol:"Custom",allowToChangeSymbolAtRuntime:"Allow to change symbol at runtime",options:"Options",allowToExport:"Allow to export",enableBuffer:"Enable buffer",defaultDistance:"Default Distance",defaultUnit:"Default Unit",unit_Miles:"Miles",unit_Kilometers:"Kilometers",unit_Feet:"Feet",unit_Meters:"Meters",unit_Yards:"Yards",unit_NauticalMiles:"Nautical miles",interactiveDrawMode:"Interactive draw mode",chooseSelectionTools:"Tools",sketchTool_point:"Point",sketchTool_polyline:"Line",sketchTool_polygon:"Polygon",sketchTool_rectangle:"Rectangle",sketchTool_circle:"Circle",spatialRelationship:"Spatial relationship",chooseSpatialRelationshipRules:"Spatial relationship rules",enableSelectTool:"Enable select tool",queryMessage:"Message",atLeastOneItemIsRequired:"At least one item is required.",configureQuery:"Configure query",hintQueryArgumentsSetting:"A query can have an attribute filter, spatial filter, or both.",chooseAMapWidget:"Choose a Map widget",noQueryTip:'Click the "{newQuery}" button to add and configure queries.',openTip:"Open tip",expressionBuilder:"Expression Builder",chooseMode:"Configure each record",configTitle:"Heading",configFields:"Display fields",resultStyle:"Result style",sortRecords:"Sort records",describeTheFilter:"Please describe the filter."},N=(e,t=[])=>t.includes(e)?t.filter((t=>t!==e)):[...t,e],h=e=>e?e.type===d.DataSourceTypes.SceneLayer?e.getAssociatedDataSource():e:null;var M=g(59587),v=g(34796);const{useState:x}=d.React;var D;(0,v.withTheme)((e=>{const{theme:t,panelVisible:a,setPanelVisible:i,getI18nMessage:l,isModal:s=!0,title:o=l("queryMessage"),bodyContent:n="",hasHeader:r=!0,hasFooter:c=!0}=e,u=()=>i(!1),p=()=>(0,d.jsx)(d.React.Fragment,null,r&&(0,d.jsx)(S.PanelHeader,{className:"py-2",title:o,onClose:u}),(0,d.jsx)(S.ModalBody,null,n),c&&(0,d.jsx)(S.ModalFooter,null,(0,d.jsx)(S.Button,{onClick:u},l("ok")))),g="ui-unit-dialog-panel";return s?(0,d.jsx)(S.Modal,{className:`${g}`,isOpen:a,toggle:u,backdrop:"static"},p()):(0,d.jsx)("div",{className:`${g} modal-dialog ${a?"":"collapse"}`,css:d.css`
      &.ui-unit-dialog-panel.modal-dialog {
        margin: 0;
        width: 100%;
        .modal-content {
          background-color: ${t.colors.palette.light[600]};
          color: ${t.colors.black};
          font-size: .75rem;
          font-weight: 400;
          border: none;
          .panel-header {
            font-size: .8125rem;
            padding: .625rem;
          }
          .modal-body {
            padding: 0 .625rem .75rem;
            white-space: normal;
          }
        }
      }
    `},(0,d.jsx)("div",{className:"modal-content"},p()))})),function(e){e.None="",e.Init="init",e.Loading="loading",e.Loaded="loaded",e.Warning="warning",e.Error="error"}(D||(D={}));const b=(0,v.withTheme)((e=>{const{theme:t,className:a,title:i,statusType:l}=e;return l&&(0,d.jsx)("div",{className:`${null!=a?a:""} ui-unit-status-indicator ui-unit-status-indicator_status-type-${l}`,title:i,css:d.css`
    &.ui-unit-status-indicator {
      display: flex;
      &.ui-unit-status-indicator_status-type-loading {
        &:before {
          @keyframes loading {
            0% {transform: rotate(0deg); };
            100% {transform: rotate(360deg)};
          }
          content: '';
          width: 1rem;
          height: 1rem;
          display: block;
          border: 1px solid ${null===(n=null===(o=null===(s=null==t?void 0:t.colors)||void 0===s?void 0:s.palette)||void 0===o?void 0:o.light)||void 0===n?void 0:n[400]};
          border-radius: 50%;
          border-top: 1px solid ${null===(u=null===(c=null===(r=null==t?void 0:t.colors)||void 0===r?void 0:r.palette)||void 0===c?void 0:c.primary)||void 0===u?void 0:u[600]};
          box-sizing: border-box;
          animation: loading 2s infinite linear;
          margin-right: .25rem;
        }
      }
    }
  `});var s,o,n,r,c,u}));var w=g(79964),f=g.n(w),T=g(94539),C=g.n(T);function R(e){const{widgetId:t,useDataSourceId:a}=e;return d.ReactRedux.useSelector((e=>{var i;let l;return l=window.jimuConfig.isBuilder?e.appStateInBuilder.appConfig:e.appConfig,(null!==(i=l.widgets[t].useDataSources)&&void 0!==i?i:[]).some((e=>e.dataSourceId===a))}))}function O(e){var t,a,i;const{widgetId:l,useDataSource:s,onStatusChange:o,onDataSourceCreated:n,showMessage:r=!1}=e,c=S.hooks.useTranslate(),u=R({widgetId:l,useDataSourceId:s.dataSourceId}),[p,g]=d.React.useState(null),[I,m]=d.React.useState(null),y=d.React.useCallback((e=>{if(e){const{status:t,instanceStatus:a}=e;a===d.DataSourceStatus.NotCreated?(g("creating"),null==o||o(!1)):a===d.DataSourceStatus.CreateError||t===d.DataSourceStatus.LoadError?(g("error"),null==o||o(!1)):t===d.DataSourceStatus.NotReady?(g("warning"),null==o||o(!1)):(g(null),null==o||o(!0))}}),[o]),j=d.React.useCallback((e=>{m(e),null==n||n(e)}),[n]),N=d.React.useCallback((()=>{m(null),g("error"),null==o||o(!1)}),[o]);let h,M,v;if("creating"===p)h=C(),M=c("loading");else if(u&&"error"!==p){if("warning"===p){const e=null===(t=null==I?void 0:I.getOriginDataSources())||void 0===t?void 0:t[0],l=null==e?void 0:e.getLabel(),o=d.appConfigUtils.getWidgetIdByOutputDataSource(s),n=null===(i=((null===(a=null===window||void 0===window?void 0:window.jimuConfig)||void 0===a?void 0:a.isBuilder)?(0,d.getAppStore)().getState().appStateInBuilder:(0,d.getAppStore)().getState()).appConfig.widgets[o])||void 0===i?void 0:i.label;v="var(--warning-700)",h=f(),M=c("outputDataIsNotGenerated",{outputDsLabel:null!=l?l:"",sourceWidgetName:null!=n?n:""})}}else h=C(),M=c("dataSourceCreateError"),v="var(--danger-500)";return(0,d.jsx)(d.React.Fragment,null,u&&(0,d.jsx)(d.DataSourceComponent,{useDataSource:s,onDataSourceInfoChange:y,onDataSourceCreated:j,onCreateDataSourceFailed:N}),"creating"===p&&(0,d.jsx)(b,{statusType:D.Loading,title:M}),(!u||"error"===p||"warning"===p)&&(0,d.jsx)("div",{className:"d-flex align-items-center"},(0,d.jsx)(S.Tooltip,{title:M},(0,d.jsx)(S.Button,{size:"sm",type:"tertiary",icon:!0},(0,d.jsx)(S.Icon,{icon:h,color:v}))),r&&(0,d.jsx)("div",{className:"status-message"},M)))}var A=g(55339),L=g.n(A),P=g(34750),Q=g.n(P),z=g(41553),Z=g.n(z),B=g(59788),E=g.n(B),k=g(96009),U=g.n(k),G=g(33869),W=g.n(G),V=g(3273),F=g.n(V),Y=g(748),H=g.n(Y);const q={iconQuery:g(9190),iconTipBulb:g(41572),iconClose:L(),iconAdd:Q(),iconSetting:Z(),arrowDown:E(),arrowUp:U(),arrowLeft:W(),arrowRight:F(),iconEmpty:H()},_={iconMap:q,iconPropMap:{defaultIconResult:{svg:q.iconQuery,properties:{color:"",filename:"filter-16.svg",originalName:"filter-16.svg",inlineSvg:!0,path:["general","filter"],size:14}}},arrangementStyleMap:{[a.Block]:{getTitle:e=>e("vertical"),icon:g(1463)},[a.Inline]:{getTitle:e=>e("horizontal"),icon:g(6650)},[a.Popper]:{getTitle:e=>e("icon"),icon:g(37083)}}};var J=g(20663),K=g(43484),$=g(15506);const X={icon:null,displayLabel:!0,sqlExprObj:null,useAttributeFilter:!0,useSpatialFilter:!0,spatialMapWidgetIds:[],spatialFilterTypes:[],spatialInteractiveCreateToolTypes:[e.Point,e.Polyline,e.Polygon,e.Rectangle,e.Circle],spatialInteractiveEnableBuffer:!1,spatialInteractiveBufferDistance:0,spatialInteractiveBufferUnit:s.Meters,spatialRelations:[l.Intersect],spatialRelationUseDataSources:[],spatialRelationEnableSelectTool:!1,spatialRelationEnableBuffer:!1,spatialRelationBufferDistance:0,spatialRelationBufferUnit:s.Meters,resultListDirection:o.Vertical,resultPagingStyle:n.MultiPage,resultFieldsType:r.PopupSetting,resultSymbolType:u.DefaultSymbol,resultCustomSymbol:{angle:0,color:[255,255,255,255],outline:{color:[255,255,255,255],style:"esriSLSSolid",type:"esriSLS",width:1},size:6,style:"esriSMSCircle",type:"esriSMS",xoffset:0,yoffset:0},resultAllowChangeSymbol:!1,allowExport:!1,sortOptions:[],itemSizeMap:{arrangementHorizontalPopper:{minSize:{width:300,height:300},defaultSize:{width:360,height:480}}}};function ee(e){var t,a,i,l;const{queryItem:s,onQueryItemChanged:o,onPropertyChanged:n}=e,[r,c]=d.React.useState(!1),u=S.hooks.useTranslate(j),p=Object.assign({},X,s),g=p.useAttributeFilter,I=null!=(null===(t=p.useDataSource)||void 0===t?void 0:t.dataSourceId),m=d.React.useCallback((()=>{c(!0)}),[c]),N=d.React.useCallback((()=>{c(!1)}),[c]),h=e=>{var t;const{dataSourceId:a,mainDataSourceId:i,dataViewId:l,rootDataSourceId:n}=s.useDataSource,r=(null===(t=null==e?void 0:e.parts)||void 0===t?void 0:t.length)>0?e:null;null==e||e.sql;let c=s.set("sqlExprObj",r);const u={dataSourceId:a,mainDataSourceId:i,dataViewId:l,rootDataSourceId:n,fields:(0,$.getJimuFieldNamesBySqlExpression)((0,d.Immutable)(r))};c=c.set("useDataSource",u),o(c,!0)},M=(0,d.jsx)("div",{className:"d-flex"},(0,d.jsx)("div",null,u("attributeFilter")),(0,d.jsx)("div",{className:"ml-auto"},(0,d.jsx)(S.Switch,{"aria-label":u("attributeFilter"),checked:g,onChange:e=>n("useAttributeFilter",e.target.checked)})));return(0,d.jsx)(y.SettingSection,{role:"group","aria-label":u("attributeFilter"),title:M},(0,d.jsx)(S.Collapse,{isOpen:g},(0,d.jsx)(y.SettingRow,{flow:"wrap",label:u("label")},(0,d.jsx)(S.TextInput,{"aria-label":u("label"),className:"w-100",size:"sm",defaultValue:null!==(a=p.attributeFilterLabel)&&void 0!==a?a:u("attributeFilter"),onAcceptValue:e=>((e,t,a)=>{n("attributeFilterLabel",t===a?null:t)})(0,e,u("attributeFilter"))})),(0,d.jsx)(y.SettingRow,{flow:"wrap",truncateLabel:!0,label:u("addSQLExpressionsToYourQuery")},(0,d.jsx)(S.Button,{className:"w-100 text-dark set-link-btn",type:I?"primary":"secondary",disabled:!I,onClick:m},u("builderName"))),(0,d.jsx)(y.SettingRow,null,(0,d.jsx)(S.TextArea,{css:d.css`
              height: 80px;
              flex: 1;
            `,value:null!==(l=null===(i=p.sqlExprObj)||void 0===i?void 0:i.displaySQL)&&void 0!==l?l:"",spellCheck:!1,readOnly:!0,onClick:e=>e.currentTarget.select(),placeholder:u("pleaseAddYourSQLExpressionsFirst")})),(0,d.jsx)(y.SettingRow,{label:u("description"),flow:"wrap"},(0,d.jsx)(S.TextArea,{"aria-label":u("description"),css:d.css`height: 80px;`,value:p.attributeFilterDesc,placeholder:u("describeTheFilter"),onAcceptValue:e=>n("attributeFilterDesc",e)}))),(0,d.jsx)(d.DataSourceComponent,{useDataSource:p.useDataSource},(e=>{if(p.sqlExprObj){const t=d.dataSourceUtils.getArcGISSQL(p.sqlExprObj,e);t.displaySQL!==p.sqlExprObj.displaySQL&&h(Object.assign({},p.sqlExprObj,t))}return(0,d.jsx)(K.SqlExpressionBuilderPopup,{dataSource:e,isOpen:r,toggle:N,expression:p.sqlExprObj,onChange:e=>h(e)})})))}const{iconMap:te}=_;function ae(e){const{queryItem:t,handleStageChange:a,onPropertyChanged:i}=e,l=Object.assign({},X,t),s=S.hooks.useTranslate(j),o=l.useSpatialFilter,n=(0,d.jsx)("div",{className:"d-flex"},(0,d.jsx)("div",null,s("spatialFilter")),(0,d.jsx)("div",{className:"ml-auto"},(0,d.jsx)(S.Switch,{checked:o,onChange:e=>i("useSpatialFilter",e.target.checked)})));return(0,d.jsx)(d.DataSourceComponent,{useDataSource:l.useDataSource},(e=>{var t;return null==e.getGeometryType()?null:(0,d.jsx)(y.SettingSection,{role:"group","aria-label":s("spatialFilter"),title:n},(0,d.jsx)(S.Collapse,{isOpen:o},(0,d.jsx)(y.SettingRow,{flow:"wrap",label:s("label")},(0,d.jsx)(S.TextInput,{"aria-label":s("label"),className:"w-100",size:"sm",defaultValue:null!==(t=l.spatialFilterLabel)&&void 0!==t?t:s("spatialFilter"),onAcceptValue:e=>((e,t,a)=>{i("spatialFilterLabel",t===a?null:t)})(0,e,s("spatialFilter"))})),(0,d.jsx)(y.SettingRow,{role:"group","aria-label":s("typesOfFilter"),flow:"wrap",label:s("typesOfFilter")},(0,d.jsx)("div",{className:"setting-ui-unit-check-input-item w-100 d-flex align-items-center"},(0,d.jsx)("label",{className:"setting-ui-unit-check-input-label my-1"},(0,d.jsx)("span",{id:"queryItemDataMode"},s("featureFromDs"))),(0,d.jsx)(S.Button,{"aria-describedby":"queryItemDataMode",className:"ml-auto",size:"sm",type:"tertiary",icon:!0,onClick:e=>a(2,e)},(0,d.jsx)(S.Icon,{size:16,icon:te.arrowRight,autoFlip:!0}))),(0,d.jsx)("div",{className:"setting-ui-unit-check-input-item w-100 d-flex align-items-center"},(0,d.jsx)("label",{className:"setting-ui-unit-check-input-label my-1"},(0,d.jsx)("span",{id:"queryItemMapMode"},s("featureFromMap"))),(0,d.jsx)(S.Button,{"aria-describedby":"queryItemMapMode",className:"ml-auto",size:"sm",type:"tertiary",icon:!0,onClick:e=>a(1,e)},(0,d.jsx)(S.Icon,{size:16,icon:te.arrowRight,autoFlip:!0})))),(0,d.jsx)(y.SettingRow,{label:s("description"),flow:"wrap"},(0,d.jsx)(S.TextArea,{"aria-label":s("description"),css:d.css`height: 80px;`,value:l.spatialFilterDesc,placeholder:s("describeTheFilter"),onAcceptValue:e=>i("spatialFilterDesc",e)}))))}))}var ie=g(39342);const le={overrideItemBlockInfo:()=>({name:M.TreeItemActionType.RenderOverrideItem,children:[{name:M.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:M.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:M.TreeItemActionType.RenderOverrideItemBody,children:[{name:M.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:M.TreeItemActionType.RenderOverrideItemDragHandle},{name:M.TreeItemActionType.RenderOverrideItemIcon,autoCollapsed:!0},{name:M.TreeItemActionType.RenderOverrideItemTitle},{name:M.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})},se=(0,v.withTheme)((function(e){const{useDataSource:t,selectedFields:a,label:i,theme:l,onFieldsChanged:s}=e,o=d.React.useMemo((()=>(0,d.Immutable)([t])),[t]),n=d.React.useMemo((()=>{const e=d.DataSourceManager.getInstance().getDataSource(null==t?void 0:t.dataSourceId);if(!e)return[];const a=null==e?void 0:e.getSchema();return(null==a?void 0:a.fields)?Object.values(a.fields):[]}),[t]),r=d.React.useMemo((()=>{var e,a,i,l,s,o;const r=d.DataSourceManager.getInstance().getDataSource(null==t?void 0:t.dataSourceId);if(r){const t=r,c=null===(a=null===(e=t.layer)||void 0===e?void 0:e.popupTemplate)||void 0===a?void 0:a.content;let u=null!==(s=null===(l=null===(i=t.layer)||void 0===i?void 0:i.popupTemplate)||void 0===l?void 0:l.fieldInfos)&&void 0!==s?s:[];(null==c?void 0:c.length)>0&&"fields"===c[0].type&&(u=null!==(o=c[0].fieldInfos)&&void 0!==o?o:[]);const d=u.map((e=>e.fieldName));return n.filter((e=>null==d?void 0:d.includes(e.name)))}return[]}),[t,n]),c=d.React.useMemo((()=>null!=a?a.map((e=>n.find((t=>t.jimuName===e)))):r),[r,n,a]),u=null!=a?a:r.map((e=>e.jimuName));return(0,d.jsx)(d.React.Fragment,null,(0,d.jsx)(y.SettingRow,{flow:"wrap",label:i},(0,d.jsx)(m.FieldSelector,{useDataSources:o,onChange:e=>{if(e){const t=e.filter((e=>e)).map((e=>e.jimuName)),i=null!=a?a.filter((e=>t.includes(e))):t,l=null!=a?t.filter((e=>!a.includes(e))):[];s(i.concat(l))}},selectedFields:(0,d.Immutable)(u),isMultiple:!0,isSearchInputHidden:!1,isDataSourceDropDownHidden:!0,useDropdown:!0,useMultiDropdownBottomTools:!0})),u.length>1&&(0,d.jsx)(y.SettingRow,null,(0,d.jsx)(M.List,Object.assign({className:"selected-fields-list w-100",itemsJson:Array.from(c).map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`,itemStateIcon:m.dataComponentsUtils.getIconFromFieldType(e.type,l),itemStateTitle:e.alias||e.jimuName||e.name,itemStateCommands:[]}))),dndEnabled:!0,onUpdateItem:(e,t)=>{const{itemJsons:a}=t.props,[,i]=a,l=i.map((e=>e.itemStateDetailContent));s(l.map((e=>e.jimuName)))},isItemFocused:()=>!1},le))))}));var oe=g(2534),ne=g.n(oe);const re=e=>{const{className:t}=e,a=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(i=Object.getOwnPropertySymbols(e);l<i.length;l++)t.indexOf(i[l])<0&&Object.prototype.propertyIsEnumerable.call(e,i[l])&&(a[i[l]]=e[i[l]])}return a}(e,["className"]),i=(0,d.classNames)("jimu-icon jimu-icon-component",t);return d.React.createElement(S.SVG,Object.assign({className:i,src:ne()},a))},ce=[{name:"preventOverflow",options:{altAxis:!0}},(0,S.getFallbackPlacementsModifier)(["left-start","left-end"],!0)];function ue(e){var t;const{widgetId:a,queryItem:i,onQueryItemChanged:l,onPropertyChanged:s}=e,[o,n]=d.React.useState(!1),[c,u]=d.React.useState(!1),p=d.React.useRef(),g=d.React.useRef(),I=S.hooks.useTranslate(j),[m,N]=d.React.useState(i.resultTitleExpression),h=Object.assign({},X,i),M=d.React.useCallback((()=>{n(!0)}),[n]),v=d.React.useCallback((()=>{n(!1)}),[n]),x=d.React.useCallback((()=>{var e;!c&&g.current&&(null===(e=g.current)||void 0===e||e.focus()),u(!c)}),[c]),D=S.hooks.useEventCallback((e=>{N(e.target.value)})),b=S.hooks.useEventCallback((e=>{s("resultTitleExpression",e)})),w=S.hooks.useEventCallback((e=>{var t;e.parts.length>0&&(N(null!=m?`${m} {${e.parts[0].jimuFieldName}}`:`{${e.parts[0].jimuFieldName}}`),null===(t=g.current)||void 0===t||t.focus())}));return(0,d.jsx)(y.SettingCollapse,{role:"group","aria-label":I("results"),label:I("results"),className:"p-3",isOpen:o,onRequestOpen:M,onRequestClose:v},(0,d.jsx)(y.SettingRow,{flow:"wrap",label:I("label")},(0,d.jsx)(S.TextInput,{"aria-label":I("label"),className:"w-100",size:"sm",value:null!==(t=h.resultsLabel)&&void 0!==t?t:I("results"),onChange:e=>{return"resultsLabel",t=e.target.value,a=I("results"),void s("resultsLabel",t===a?null:t);var t,a}})),(0,d.jsx)(y.SettingRow,{flow:"wrap",label:I("chooseMode")},(0,d.jsx)(S.Select,{"aria-label":I("chooseMode"),className:"w-100",size:"sm",value:h.resultFieldsType,onChange:e=>{s("resultFieldsType",e.target.value,!0)}},(0,d.jsx)("option",{value:r.PopupSetting},I("field_PopupSetting")),(0,d.jsx)("option",{value:r.SelectAttributes},I("field_SelectAttributes")))),h.resultFieldsType===r.SelectAttributes&&(0,d.jsx)(y.SettingRow,{flow:"wrap",label:I("configTitle")},(0,d.jsx)(S.TextArea,{"aria-label":I("configTitle"),className:"mt-2 w-100",css:d.css`background-color: var(--light-200);height: 80px;z-index: 1;`,onChange:D,onAcceptValue:b,spellCheck:!1,value:m,ref:g}),(0,d.jsx)("div",{className:"w-100",css:d.css`height: 32px; background-color: var(--light-200);`},(0,d.jsx)(S.Button,{"aria-label":I("configTitle"),ref:p,onClick:x,type:"tertiary",icon:!0},(0,d.jsx)(re,{size:"s"}))),(0,d.jsx)(S.Popper,{open:c,disableResize:!0,placement:"left-start",reference:p.current,modifiers:ce,showArrow:!0,toggle:x,trapFocus:!1,autoFocus:!1},(0,d.jsx)("div",{css:d.css`
              width: 240px;
              height: 360px;
              .component-main-data-and-view {
                display: none;
              }
              .field-list {
                height: calc(100% - 60px) !important;
              }
            `},(0,d.jsx)(ie.ExpressionBuilder,{widgetId:a,types:(0,d.Immutable)([ie.ExpressionBuilderType.Attribute]),useDataSources:(0,d.Immutable)([i.useDataSource]),expression:null,onChange:w})))),h.resultFieldsType===r.SelectAttributes&&(0,d.jsx)(se,{useDataSource:i.useDataSource,label:I("configFields"),selectedFields:i.resultDisplayFields,onFieldsChanged:e=>s("resultDisplayFields",e,!0)}),(0,d.jsx)(y.SettingRow,{role:"group","aria-label":I("sortRecords"),flow:"wrap",label:I("sortRecords"),css:d.css`.no-sort-remind {margin-top: 0 !important;}`},(0,d.jsx)(K.Sort,{onChange:e=>(e=>{const{dataSourceId:t,mainDataSourceId:a,dataViewId:s,rootDataSourceId:o}=i.useDataSource,n={dataSourceId:t,mainDataSourceId:a,dataViewId:s,rootDataSourceId:o,fields:i.useDataSource.fields};let r=i.set("sortOptions",e);r=r.set("useDataSource",n),l(r,!0)})(e),value:(0,d.Immutable)(h.sortOptions),useDataSource:h.useDataSource})))}const de=(0,d.Immutable)([m.AllDataSourceTypes.FeatureLayer,m.AllDataSourceTypes.SceneLayer]);function pe(e){var t;const{index:i,total:l,arrangeType:s,widgetId:o,queryItem:n,onQueryItemAdded:r,onQueryItemChanged:c,handleStageChange:u,visible:p}=e,g=S.hooks.useTranslate(j),[I,N]=d.React.useState(""),M=Object.assign({},X,n),v=d.React.useRef(),x=null!=M.useDataSource?(0,d.Immutable)([M.useDataSource]):void 0,D=R({widgetId:o,useDataSourceId:null===(t=M.useDataSource)||void 0===t?void 0:t.dataSourceId});d.React.useEffect((()=>{(null==n?void 0:n.name)&&I!==n.name&&N(n.name)}),[null==n?void 0:n.name]),d.React.useEffect((()=>{p&&v.current&&v.current.focus()}),[p]);const b=d.React.useCallback(((e,t)=>{v.current=t.target,u(e)}),[u]),w=d.React.useCallback(((e,t,a=!1)=>{let l;l=null==t?n.without(e):n.set(e,t),c(i,l,a)}),[c,i,n]),f=(e,t=!1)=>{c(i,e,t)},T=d.React.useCallback((e=>N(e.target.value)),[]),C=d.React.useCallback((e=>{e.trim().length>0?w("name",e,!0):N(n.name)}),[null==n?void 0:n.name,w]);return(0,d.jsx)("div",{className:(0,d.classNames)("h-100",{"d-none":!p})},(0,d.jsx)("div",{css:d.css`height: 100%;overflow: auto;`},(0,d.jsx)(y.SettingSection,{role:"group","aria-label":g("data"),title:g("data"),className:"pt-0"},(0,d.jsx)(y.SettingRow,null,(0,d.jsx)(m.DataSourceSelector,{widgetId:o,disableRemove:()=>!0,mustUseDataSource:!0,closeDataSourceListOnChange:!0,types:de,isMultiple:!1,useDataSources:x,onChange:e=>{var t;(t=null==e?void 0:e[0])&&d.DataSourceManager.getInstance().createDataSourceByUseDataSource((0,d.Immutable)(t)).then((e=>{const t=h(e);return t||Promise.reject(Error("")),t})).then((e=>{if(null==n){const a=function(e,t,a){const i=`${Math.random()}`.slice(2),l=null==a?void 0:a.getLabel();return(0,d.Immutable)({configId:i,name:l,useDataSource:t,outputDataSourceId:`${e}_output_${i}`,spatialRelationUseDataSources:[]})}(o,t,e);r(a)}else{const a=n.set("useDataSource",t).set("name",null==e?void 0:e.getLabel());c(i,a,!0)}}))}}))),n&&D&&(0,d.jsx)(d.React.Fragment,null,(0,d.jsx)(y.SettingSection,{role:"group","aria-label":g("label"),title:g("label")},(0,d.jsx)(y.SettingRow,null,(0,d.jsx)(S.TextInput,{"aria-label":g("label"),className:"w-100",size:"sm",value:I,onChange:T,onAcceptValue:C})),l<2&&s!==a.Inline&&(0,d.jsx)(y.SettingRow,{label:g("displayLabel")},(0,d.jsx)(S.Switch,{"aria-label":g("displayLabel"),checked:M.displayLabel,onChange:e=>w("displayLabel",e.target.checked)}))),(0,d.jsx)(y.SettingSection,{role:"group","aria-label":g("icon")},(0,d.jsx)(y.SettingRow,{label:g("icon")},(0,d.jsx)(J.IconPicker,{icon:M.icon,onChange:e=>w("icon",e),configurableOption:"none"}))),(0,d.jsx)(ee,{queryItem:n,onPropertyChanged:w,onQueryItemChanged:f}),(0,d.jsx)(ae,{queryItem:n,onPropertyChanged:w,handleStageChange:b}),(0,d.jsx)(ue,{widgetId:o,queryItem:n,onPropertyChanged:w,onQueryItemChanged:f}))))}var ge=g(43126),Ie=g.n(ge),me=g(87783),Se=g.n(me),ye=g(45859),je=g.n(ye),Ne=g(86567),he=g.n(Ne);function Me(e){const{enabled:t,distance:a,unit:i,onEnableChanged:l,onDistanceChanged:o,onUnitChanged:n}=e,r=S.hooks.useTranslate(j);return(0,d.jsx)(d.React.Fragment,null,(0,d.jsx)(y.SettingRow,{label:r("enableBuffer")},(0,d.jsx)(S.Switch,{"aria-label":r("enableBuffer"),checked:t,onChange:e=>l(e.target.checked)})),t&&(0,d.jsx)(d.React.Fragment,null,(0,d.jsx)(y.SettingRow,{label:r("defaultDistance")},(0,d.jsx)(S.NumericInput,{css:d.css`
                flex: 0 0 40%;
              `,"aria-label":r("defaultDistance"),className:"w-100",size:"sm",value:a,onChange:e=>o(e)})),(0,d.jsx)(y.SettingRow,{label:r("defaultUnit")},(0,d.jsx)(S.Select,{css:d.css`
                flex: 0 0 40%;
              `,size:"sm",value:i,"aria-label":r("defaultUnit"),onChange:e=>n(e.target.value)},Object.values(s).map((e=>(0,d.jsx)("option",{key:e,value:e},r(`unit_${e}`))))))))}var ve=g(29786),xe=g.n(ve);const De=e=>{const{className:t}=e,a=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(i=Object.getOwnPropertySymbols(e);l<i.length;l++)t.indexOf(i[l])<0&&Object.prototype.propertyIsEnumerable.call(e,i[l])&&(a[i[l]]=e[i[l]])}return a}(e,["className"]),i=(0,d.classNames)("jimu-icon jimu-icon-component",t);return d.React.createElement(S.SVG,Object.assign({className:i,src:W()},a))},be=[{type:e.Point,drawToolName:"point",icon:(0,d.jsx)((e=>{const{className:t}=e,a=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(i=Object.getOwnPropertySymbols(e);l<i.length;l++)t.indexOf(i[l])<0&&Object.prototype.propertyIsEnumerable.call(e,i[l])&&(a[i[l]]=e[i[l]])}return a}(e,["className"]),i=(0,d.classNames)("jimu-icon jimu-icon-component",t);return d.React.createElement(S.SVG,Object.assign({className:i,src:xe()},a))}),null)},{type:e.Polyline,drawToolName:"polyline",icon:(0,d.jsx)((e=>{const{className:t}=e,a=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(i=Object.getOwnPropertySymbols(e);l<i.length;l++)t.indexOf(i[l])<0&&Object.prototype.propertyIsEnumerable.call(e,i[l])&&(a[i[l]]=e[i[l]])}return a}(e,["className"]),i=(0,d.classNames)("jimu-icon jimu-icon-component",t);return d.React.createElement(S.SVG,Object.assign({className:i,src:Ie()},a))}),null)},{type:e.Polygon,drawToolName:"polygon",icon:(0,d.jsx)((e=>{const{className:t}=e,a=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(i=Object.getOwnPropertySymbols(e);l<i.length;l++)t.indexOf(i[l])<0&&Object.prototype.propertyIsEnumerable.call(e,i[l])&&(a[i[l]]=e[i[l]])}return a}(e,["className"]),i=(0,d.classNames)("jimu-icon jimu-icon-component",t);return d.React.createElement(S.SVG,Object.assign({className:i,src:Se()},a))}),null)},{type:e.Rectangle,drawToolName:"rectangle",icon:(0,d.jsx)((e=>{const{className:t}=e,a=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(i=Object.getOwnPropertySymbols(e);l<i.length;l++)t.indexOf(i[l])<0&&Object.prototype.propertyIsEnumerable.call(e,i[l])&&(a[i[l]]=e[i[l]])}return a}(e,["className"]),i=(0,d.classNames)("jimu-icon jimu-icon-component",t);return d.React.createElement(S.SVG,Object.assign({className:i,src:je()},a))}),null)},{type:e.Circle,drawToolName:"circle",icon:(0,d.jsx)((e=>{const{className:t}=e,a=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(i=Object.getOwnPropertySymbols(e);l<i.length;l++)t.indexOf(i[l])<0&&Object.prototype.propertyIsEnumerable.call(e,i[l])&&(a[i[l]]=e[i[l]])}return a}(e,["className"]),i=(0,d.classNames)("jimu-icon jimu-icon-component",t);return d.React.createElement(S.SVG,Object.assign({className:i,src:he()},a))}),null)}],we=d.css`
  border-top: 1px solid var(--light-800);
  .title {
    font-weight: 500;
    font-size: 14px;
    color: var(--dark-600);
  }
`;function fe(e){const{index:t,handleStageChange:a,queryItem:l,onQueryItemChanged:s,visible:o}=e,n=S.hooks.useTranslate(j),r=d.React.useRef(),c=Object.assign({},X,l),u=d.ReactRedux.useSelector((e=>{var t;if((null===(t=l.spatialMapWidgetIds)||void 0===t?void 0:t.length)>0){const t=l.spatialMapWidgetIds[0];return null!=e.appStateInBuilder.appConfig.widgets[t]}return!1})),p=d.React.useCallback(((e,a,i=!1)=>{const o=l.set(e,a);s(t,o,i)}),[s,l,t]);d.React.useEffect((()=>{o&&r.current.focus()}),[o]);const g=d.React.useCallback((e=>{const t=N(e,l.spatialFilterTypes?[...l.spatialFilterTypes]:[]);p("spatialFilterTypes",t)}),[p,l]),I=d.React.useCallback((e=>{let a=l.set("spatialMapWidgetIds",e);e&&0!==e.length||(a=a.set("spatialFilterTypes",[])),s(t,a,!1)}),[s,t,l]);return l?(0,d.jsx)("div",{className:(0,d.classNames)({"d-none":!o})},(0,d.jsx)("div",{className:"d-flex align-items-center px-3 pt-3",css:we},(0,d.jsx)(S.Button,{ref:r,"aria-label":n("back"),type:"tertiary",size:"sm",icon:!0,className:"p-0 action-btn",onClick:()=>a(0)},(0,d.jsx)(De,{autoFlip:!0})),(0,d.jsx)("div",{className:"title flex-grow-1 text-truncate ml-2",title:n("featureFromMap")},n("featureFromMap"))),(0,d.jsx)(y.SettingSection,{role:"group","aria-label":n("chooseAMapWidget"),title:n("chooseAMapWidget"),className:"text-truncate"},(0,d.jsx)(y.SettingRow,null,(0,d.jsx)(y.MapWidgetSelector,{onSelect:I,useMapWidgetIds:c.spatialMapWidgetIds}))),u&&(0,d.jsx)(y.SettingSection,{role:"group","aria-label":n("geometryTypes"),title:n("geometryTypes")},(0,d.jsx)(y.SettingRow,null,(0,d.jsx)("label",null,(0,d.jsx)(S.Checkbox,{className:"mr-2",checked:c.spatialFilterTypes.includes(i.CurrentMapExtent),onChange:()=>g(i.CurrentMapExtent)}),(0,d.jsx)("span",null,n("spatialFilterType_CurrentMapExtent")))),(0,d.jsx)(y.SettingRow,null,(0,d.jsx)("label",null,(0,d.jsx)(S.Checkbox,{className:"mr-2",checked:c.spatialFilterTypes.includes(i.InteractiveDrawMode),onChange:()=>g(i.InteractiveDrawMode)}),(0,d.jsx)("span",null,n("spatialFilterType_InteractiveDrawMode")))),c.spatialFilterTypes.includes(i.InteractiveDrawMode)&&(0,d.jsx)(d.React.Fragment,null,(0,d.jsx)(y.SettingRow,{role:"group","aria-label":n("chooseSelectionTools"),flow:"wrap",className:"d-block",label:n("chooseSelectionTools")},be.map((e=>{const{type:t,icon:a,drawToolName:i}=e,l=c.spatialInteractiveCreateToolTypes,s=l.includes(t);return(0,d.jsx)("div",{key:t,className:"d-flex mt-2"},a,(0,d.jsx)("label",{className:"ml-2"},n(`sketchTool_${i}`)),(0,d.jsx)(S.Switch,{"aria-label":n(`sketchTool_${i}`),className:"ml-auto",checked:s,onChange:()=>{const e=N(t,[...l]);p("spatialInteractiveCreateToolTypes",e)}}))}))),(0,d.jsx)(Me,{enabled:c.spatialInteractiveEnableBuffer,distance:c.spatialInteractiveBufferDistance,unit:c.spatialInteractiveBufferUnit,onEnableChanged:e=>p("spatialInteractiveEnableBuffer",e),onDistanceChanged:e=>p("spatialInteractiveBufferDistance",e),onUnitChanged:e=>p("spatialInteractiveBufferUnit",e)})))):null}const Te=d.css`
  border-top: 1px solid var(--light-800);
  .title {
    font-weight: 500;
    font-size: 14px;
    color: var(--dark-600);
  }
`,Ce=(0,d.Immutable)([m.AllDataSourceTypes.FeatureLayer]),Re={overrideItemBlockInfo:()=>({name:M.TreeItemActionType.RenderOverrideItem,children:[{name:M.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:M.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:M.TreeItemActionType.RenderOverrideItemBody,children:[{name:M.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:M.TreeItemActionType.RenderOverrideItemDragHandle},{name:M.TreeItemActionType.RenderOverrideItemTitle}]}]}]}]}]})};function Oe(e){return null==e.geometryType}function Ae(e){var t,a;const{index:i,widgetId:s,handleStageChange:o,queryItem:n,onQueryItemChanged:r,visible:c}=e,u=S.hooks.useTranslate(j),p=d.React.useRef(),g=d.React.useMemo((()=>(0,d.Immutable)(Object.entries(l).map((([e,t])=>({value:t,label:u(`spatialRelation_${e}`)}))))),[u]);d.React.useEffect((()=>{c&&p.current.focus()}),[c]);const I=(e,t,a=!1)=>{const l=n.set(e,t);r(i,l,a)},N=d.React.useCallback((e=>u("numSelected",{number:e.length})),[u]),h=S.hooks.useEventCallback(((e,t,a)=>{I("spatialRelations",a)})),v=S.hooks.useEventCallback((e=>{const t=e.map((e=>e.dataViewId!==d.CONSTANTS.SELECTION_DATA_VIEW_ID?Object.assign(Object.assign({},e),{dataSourceId:d.DataSourceManager.getInstance().getDataSource(e.mainDataSourceId).getDataView(d.CONSTANTS.SELECTION_DATA_VIEW_ID).id,dataViewId:d.CONSTANTS.SELECTION_DATA_VIEW_ID}):e));I("spatialRelationUseDataSources",t,!0)})),x=Object.assign({},X,n),D=(0,d.Immutable)(null!==(t=x.spatialRelationUseDataSources)&&void 0!==t?t:[]),b=(0,d.Immutable)(null===(a=x.spatialRelations)||void 0===a?void 0:a.filter((e=>Object.values(l).includes(e))));return n?(0,d.jsx)("div",{className:(0,d.classNames)({"d-none":!c})},(0,d.jsx)("div",{className:"d-flex align-items-center px-3 pt-3",css:Te},(0,d.jsx)(S.Button,{ref:p,"aria-label":u("back"),type:"tertiary",size:"sm",icon:!0,className:"p-0 action-btn",onClick:()=>o(0)},(0,d.jsx)(De,{autoFlip:!0})),(0,d.jsx)("div",{className:"title flex-grow-1 text-truncate ml-2",title:u("featureFromDs")},u("featureFromDs"))),(0,d.jsx)("div",{css:d.css`height: calc(100% - 30px); overflow: auto;`},(0,d.jsx)(y.SettingSection,{role:"group","aria-label":u("selectionViewOnly")},(0,d.jsx)(y.SettingRow,{flow:"wrap",truncateLabel:!0,label:u("selectionViewOnly")},(0,d.jsx)(m.DataSourceSelector,{widgetId:s,buttonLabel:u("newFilterLayer"),disableRemove:()=>!1,disableDataView:!0,mustUseDataSource:!0,types:Ce,isMultiple:!0,hideDs:Oe,isMultipleDataView:!1,useDataSources:D,onChange:v}))),(0,d.jsx)(y.SettingSection,null,(0,d.jsx)(y.SettingRow,{flow:"wrap",label:u("chooseSpatialRelationshipRules")},(0,d.jsx)(S.MultiSelect,{"aria-label":u("chooseSpatialRelationshipRules"),items:g,values:b,fluid:!0,onClickItem:h,displayByValues:N,size:"sm"})),(null==b?void 0:b.length)>0&&(0,d.jsx)(y.SettingRow,null,(0,d.jsx)(M.List,Object.assign({className:"selected-fields-list w-100",itemsJson:Array.from(b).map(((e,t)=>{const a=g.find((t=>t.value===e)).label;return{itemStateDetailContent:e,itemKey:`${t}`,itemStateTitle:a,itemStateCommands:[]}})),dndEnabled:!0,onUpdateItem:(e,t)=>{const{itemJsons:a}=t.props,[,i]=a,l=i.map((e=>e.itemStateDetailContent));I("spatialRelations",l)},isItemFocused:()=>!1},Re)))),(0,d.jsx)(y.SettingSection,null,(0,d.jsx)(Me,{enabled:x.spatialRelationEnableBuffer,distance:x.spatialRelationBufferDistance,unit:x.spatialRelationBufferUnit,onEnableChanged:e=>I("spatialRelationEnableBuffer",e),onDistanceChanged:e=>I("spatialRelationBufferDistance",e),onUnitChanged:e=>I("spatialRelationBufferUnit",e)})))):null}function Le(e){const{widgetId:t,index:a,queryItem:i,onQueryItemChanged:l}=e,[s,o]=d.React.useState(0);d.React.useEffect((()=>{(null==i?void 0:i.useDataSource)||o(0)}),[null==i?void 0:i.useDataSource]);const n=e=>{e>=0&&o(e)};return(0,d.jsx)("div",{className:"h-100"},(0,d.jsx)(pe,Object.assign({},e,{visible:0===s,handleStageChange:n})),i&&(0,d.jsx)(fe,{index:a,queryItem:i,visible:1===s,onQueryItemChanged:l,handleStageChange:n}),i&&(0,d.jsx)(Ae,{index:a,widgetId:t,queryItem:i,visible:2===s,onQueryItemChanged:l,handleStageChange:n}))}const{iconMap:Pe,iconPropMap:Qe}=_,ze=d.css`
  position: relative;
  overflow: hidden;
  & > div {
    top: 50%;
    width: 100%;
    transform: translateY(-50%);
    color: var(--dark-200);
  }
  p {
    color: var(--dark-500);
    font-size: ${d.polished.rem(14)};
    margin: ${d.polished.rem(16)} auto 0;
    line-height: ${d.polished.rem(19)};
    width: ${d.polished.rem(228)};
  }
`;function Ze(e){const{queryItems:t=[],onNewQueryItemAdded:a,onQueryItemChanged:i,onQueryItemRemoved:l,onOrderChanged:s}=e,o=d.React.useRef(null),n=d.React.useRef(null),[r,c]=d.React.useState(-1),u=S.hooks.useTranslate(j),p=S.hooks.useRefValue(r),g=d.React.useCallback((()=>{c(t.length)}),[t.length]),I=d.React.useCallback((()=>{c(-1)}),[]),m={isItemFocused:(e,t)=>{const{itemJsons:[a]}=t.props;return r===+(null==a?void 0:a.itemKey)},overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:M.TreeItemActionType.RenderOverrideItem,children:[{name:M.TreeItemActionType.RenderOverrideItemDroppableContainer,withListGroupItemWrapper:!1,children:[{name:M.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:M.TreeItemActionType.RenderOverrideItemBody,children:[{name:M.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:M.TreeItemActionType.RenderOverrideItemDragHandle},{name:M.TreeItemActionType.RenderOverrideItemIcon,autoCollapsed:!0},{name:M.TreeItemActionType.RenderOverrideItemTitle},{name:M.TreeItemActionType.RenderOverrideItemDetailToggle},{name:M.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})};return(0,d.jsx)("div",{ref:o,css:d.css`border-bottom: 1px solid var(--light-800);`,className:(0,d.classNames)("d-flex flex-column",{"h-100":0===t.length})},(0,d.jsx)(y.SettingSection,{role:"group","aria-label":u("queryItem"),title:u("queryItem")},(0,d.jsx)(y.SettingRow,{flow:"wrap"},(0,d.jsx)(S.Button,{"aria-describedby":0===t.length?"noQueryItemDesc":void 0,className:"w-100 text-dark set-link-btn",onClick:g,type:"primary",ref:n},(0,d.jsx)("div",{className:"w-100 px-2 text-truncate"},(0,d.jsx)(S.Icon,{icon:Pe.iconAdd,className:"mr-1",size:14}),u("newQuery")))),(0,d.jsx)("div",{className:"setting-ui-unit-list mt-3"},(0,d.jsx)(M.List,Object.assign({className:"setting-ui-unit-list-exsiting",itemsJson:t.map(((e,t)=>{var a;return{itemStateDetailContent:e,itemKey:`${t}`,itemStateIcon:{icon:null===(a=e.icon)||void 0===a?void 0:a.svg},itemStateTitle:e.name,itemStateCommands:[{label:u("remove"),iconProps:()=>({icon:Pe.iconClose,size:12}),action:({data:e})=>{const{itemJsons:[t]}=e;l(+t.itemKey)}}]}})),dndEnabled:!0,renderOverrideItemDetailToggle:(t,a)=>{var i;const{itemJsons:l}=a.props,[s]=l,o=null===(i=null==s?void 0:s.itemStateDetailContent)||void 0===i?void 0:i.useDataSource;return(0,d.jsx)(O,{widgetId:e.widgetId,useDataSource:o})},onUpdateItem:(e,t)=>{const{itemJsons:a}=t.props,[,i]=a;s(i.map((e=>e.itemStateDetailContent)))},onClickItemBody:(e,t)=>{const{itemJsons:[a]}=t.props;var i;i=+a.itemKey,p.current===i?c(-1):c(i)}},m)),t.length===r&&(0,d.jsx)(M.List,Object.assign({className:"setting-ui-unit-list-new pt-1",itemsJson:[{icon:Qe.defaultIconResult,name:"......"}].map((e=>{var t;return{itemStateDetailContent:e,itemKey:`${r}`,itemStateIcon:{icon:null===(t=e.icon)||void 0===t?void 0:t.svg},itemStateTitle:e.name,itemStateCommands:[]}})),dndEnabled:!1},m)))),0===t.length&&t.length!==r&&(0,d.jsx)("div",{className:"text-center flex-grow-1",css:ze},(0,d.jsx)("div",{className:"position-absolute"},(0,d.jsx)(S.Icon,{size:48,icon:Pe.iconEmpty}),(0,d.jsx)("p",{id:"noQueryItemDesc",className:"trigger-tip"},u("noQueryTip",{newQuery:u("newQuery")})))),(0,d.jsx)(y.SidePopper,{isOpen:r>=0&&!d.urlUtils.getAppIdPageIdFromUrl().pageId,toggle:I,position:"right",trigger:o.current,title:u("setQuery"),backToFocusNode:n.current},(0,d.jsx)("div",{className:"setting-query__query-item-panel w-100 h-100"},(0,d.jsx)(Le,{widgetId:e.widgetId,index:r,total:t.length,arrangeType:e.arrangeType,queryItem:t[r],onQueryItemAdded:a,onQueryItemChanged:i}))))}const{arrangementStyleMap:Be}=_,Ee=d.css`
  .icon-btn {
    padding: 0;
    &.active {
      outline: 2px solid var(--primary-600) !important;
    }
    img {
      background-color: var(--light-200);
    }
  }
`;function ke(e){const{arrangeType:t,arrangeWrap:i=!1,onArrangeTypeChanged:l,onArrangeWrapChanged:s}=e,o=S.hooks.useTranslate(j);return(0,d.jsx)(y.SettingSection,{role:"group","aria-label":o("arrangementStyle"),title:o("arrangementStyle"),css:Ee},(0,d.jsx)(y.SettingRow,{flow:"wrap"},(0,d.jsx)(S.ButtonGroup,{className:"w-100 d-flex justify-content-between"},Object.entries(Be).map((([e,a])=>(0,d.jsx)(S.Tooltip,{key:e,title:a.getTitle(o),placement:"bottom"},(0,d.jsx)(S.Button,{onClick:()=>l(e),icon:!0,size:"sm",type:"tertiary",active:t===e,"aria-pressed":t===e},(0,d.jsx)(S.Icon,{width:68,height:68,icon:a.icon,autoFlip:!0}))))))),t===a.Inline&&(0,d.jsx)(y.SettingRow,{label:o("wrapItems")},(0,d.jsx)(S.Switch,{"aria-label":o("wrapItems"),checked:i,onChange:e=>s(e.target.checked)})))}class Ue extends d.React.PureComponent{constructor(e){super(e),this.getI18nMessage=function(e){const{intl:t,defaultMessages:a={}}=e||{};return(e,i)=>{const{messages:l,values:s}=i||{};return t.formatMessage({id:e,defaultMessage:(l||a)[e]},s)}}({intl:this.props.intl,defaultMessages:j}),this.updateWidgetJson=(...e)=>{const[t,...a]=e,i=Object.assign(Object.assign({id:this.props.id},t));this.props.onSettingChange(i,...a)},this.updateConfigForOptions=(...e)=>{let t=null;const a=e.reduce(((e,[a,i,l])=>("queryItems"===a&&(null==l?void 0:l.dsUpdateRequired)&&(t=this.getAllDataSources(i)),e.set(a,i))),this.props.config);t?this.updateWidgetJson({config:a,useDataSources:Object.values(t.useDataSourceMap)},t.outputDataSources):this.updateWidgetJson({config:a})},this.handleArrangeTypeChange=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("arrangeType",e)})},this.handleArrangeWrapChange=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("arrangeWrap",e)})},this.handleResultDirectionChange=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("resultListDirection",e?o.Vertical:o.Horizontal)})},this.handleResultPageStyleChange=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("resultPagingStyle",e.target.value)})},this.tryRemoveQueryItem=e=>{const t=this.props.config.queryItems[e],a=(0,p.getAppConfigAction)().appConfig;0===m.dataComponentsUtils.getWidgetsUsingDsOrItsDescendantDss(t.outputDataSourceId,a.widgets).length?this.doRemoveQueryItem(e,!0):this.setState({showRemoveQueryItemWarning:!0,indexOfQueryItemToRemove:e,dsToRemove:t.outputDataSourceId})},this.beforeRemovingDataSource=()=>{this.doRemoveQueryItem(this.state.indexOfQueryItemToRemove)},this.doRemoveQueryItem=(e,t=!1)=>{const a={dsUpdateRequired:t},i=this.props.config.queryItems.asMutable({deep:!0});i.splice(e,1),this.updateConfigForOptions(["queryItems",i,a])},this.afterRemovingDataSource=()=>{this.setState({showRemoveQueryItemWarning:!1,indexOfQueryItemToRemove:-1,dsToRemove:null})},this.addQueryItem=e=>{var t,a;this.updateQueryItem(null!==(a=null===(t=this.props.config.queryItems)||void 0===t?void 0:t.length)&&void 0!==a?a:0,e,!0)},this.updateQueryItem=(e,t,a=!1)=>{var i;let l=null!==(i=this.props.config.queryItems)&&void 0!==i?i:(0,d.Immutable)([]);l=d.Immutable.set(l,e,t),this.updateConfigForOptions(["queryItems",l,{dsUpdateRequired:a}])},this.reOrderQueryItems=e=>{this.updateConfigForOptions(["queryItems",e])},this.getAllDataSources=e=>(0,d.Immutable)(e).asMutable({deep:!0}).reduce(((e,t)=>{var a,i;[t.useDataSource,...t.spatialRelationUseDataSources].forEach((a=>{const i=a.dataSourceId;e.useDataSourceMap[i]=e.useDataSourceMap[i]||a;const l=(t.sortOptions||[]).filter((e=>e.jimuFieldName)).map((e=>e.jimuFieldName));e.useDataSourceMap[i].fields=Array.from(new Set([...a.fields||[],...t.resultFieldsType===r.SelectAttributes&&t.resultDisplayFields?t.resultDisplayFields:[],...l]))}));const l=d.DataSourceManager.getInstance().getDataSource(null===(a=t.useDataSource)||void 0===a?void 0:a.dataSourceId);if(l){const a=null===(i=h(l))||void 0===i?void 0:i.getDataSourceJson(),s={id:t.outputDataSourceId,label:this.getI18nMessage("outputDsLabel",{values:{label:`${t.name}`}}),type:null==a?void 0:a.type,geometryType:null==a?void 0:a.geometryType,url:null==a?void 0:a.url,itemId:null==a?void 0:a.itemId,portalUrl:null==a?void 0:a.portalUrl,originDataSources:[t.useDataSource],layerId:null==a?void 0:a.layerId,isDataInDataSourceInstance:null==a?void 0:a.isDataInDataSourceInstance};e.outputDataSources.push(s)}return e}),{useDataSourceMap:{},outputDataSources:[]}),this.hideRemovePopup=()=>{this.setState({showRemoveQueryItemWarning:!1})},this.state={showRemoveQueryItemWarning:!1,indexOfQueryItemToRemove:-1,dsToRemove:null}}render(){var e,t,a,i,l,s;const{config:r}=this.props;let{resultListDirection:c,resultPagingStyle:u}=r;return c||(c=null!==(a=null===(t=null===(e=r.queryItems)||void 0===e?void 0:e[0])||void 0===t?void 0:t.resultListDirection)&&void 0!==a?a:o.Vertical),u||(u=null!==(s=null===(l=null===(i=r.queryItems)||void 0===i?void 0:i[0])||void 0===l?void 0:l.resultPagingStyle)&&void 0!==s?s:n.MultiPage),(0,d.jsx)("div",{className:"setting-query h-100"},(0,d.jsx)("div",{className:"jimu-widget-setting setting-query__setting-content"},(0,d.jsx)(Ze,{widgetId:this.props.id,arrangeType:this.props.config.arrangeType,queryItems:this.props.config.queryItems,onNewQueryItemAdded:this.addQueryItem,onQueryItemRemoved:this.tryRemoveQueryItem,onQueryItemChanged:this.updateQueryItem,onOrderChanged:this.reOrderQueryItems}),this.props.config.queryItems.length>0&&(0,d.jsx)(ke,{arrangeType:r.arrangeType,arrangeWrap:r.arrangeWrap,onArrangeTypeChanged:this.handleArrangeTypeChange,onArrangeWrapChanged:this.handleArrangeWrapChange}),this.props.config.queryItems.length>0&&(0,d.jsx)(y.SettingSection,{role:"group","aria-label":this.getI18nMessage("resultStyle"),title:this.getI18nMessage("resultStyle")},(0,d.jsx)(y.SettingRow,{label:this.getI18nMessage("listDirection")},(0,d.jsx)(y.DirectionSelector,{"aria-label":this.getI18nMessage("listDirection"),vertical:c===o.Vertical,onChange:this.handleResultDirectionChange})),(0,d.jsx)(y.SettingRow,{flow:"wrap",label:this.getI18nMessage("pagingStyle")},(0,d.jsx)(S.Select,{"aria-label":this.getI18nMessage("pagingStyle"),className:"w-100",size:"sm",value:u,onChange:this.handleResultPageStyleChange},(0,d.jsx)("option",{value:n.MultiPage},this.getI18nMessage("pagingStyle_MultiPage")),(0,d.jsx)("option",{value:n.LazyLoad},this.getI18nMessage("pagingStyle_LazyLoad")))))),(0,d.jsx)(m.DataSourceRemoveWarningPopup,{dataSourceId:this.state.dsToRemove,isOpen:this.state.showRemoveQueryItemWarning,toggle:this.hideRemovePopup,reason:m.DataSourceRemoveWaringReason.DataSourceRemoved,afterRemove:this.afterRemovingDataSource,beforeRemove:this.beforeRemovingDataSource}))}}})(),I})())}}}));