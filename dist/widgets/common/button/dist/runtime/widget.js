System.register(["jimu-core","jimu-ui"],(function(e,t){var s={},i={};return{setters:[function(e){s.AppMode=e.AppMode,s.BaseVersionManager=e.BaseVersionManager,s.ExpressionPartType=e.ExpressionPartType,s.ExpressionResolverComponent=e.ExpressionResolverComponent,s.ExpressionResolverErrorCode=e.ExpressionResolverErrorCode,s.Immutable=e.Immutable,s.LinkType=e.LinkType,s.React=e.React,s.appActions=e.appActions,s.classNames=e.classNames,s.css=e.css,s.getAppStore=e.getAppStore,s.jsx=e.jsx},function(e){i.DistanceUnits=e.DistanceUnits,i.Icon=e.Icon,i.Link=e.Link,i.defaultMessages=e.defaultMessages,i.styleUtils=e.styleUtils,i.utils=e.utils}],execute:function(){e((()=>{var e={48891:e=>{"use strict";e.exports=s},30726:e=>{"use strict";e.exports=i}},t={};function o(s){var i=t[s];if(void 0!==i)return i.exports;var n=t[s]={exports:{}};return e[s](n,n.exports,o),n.exports}o.d=(e,t)=>{for(var s in t)o.o(t,s)&&!o.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.p="";var n={};return o.p=window.jimuConfig.baseUrl,(()=>{"use strict";o.r(n),o.d(n,{default:()=>a});var e,t=o(48891),s=o(30726);!function(e){e.Left="LEFT",e.Right="RIGHT"}(e||(e={}));class i extends t.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.0.0",description:"The first release.",upgrader:e=>{let t=e;return t.getIn(["styleConfig","name"])&&(t=t.set("styleConfig",t.styleConfig.without("name"))),t.getIn(["styleConfig","customStyle"])&&(t=t.set("styleConfig",t.styleConfig.without("customStyle"))),t.getIn(["styleConfig","themeStyle","quickStyleType"])&&(t=t.setIn(["styleConfig","themeStyle"],{quickStyleType:t.styleConfig.themeStyle.quickStyleType})),t=t.setIn(["styleConfig","useCustom"],!1),t}},{version:"1.1.0",description:"1.1.0",upgrader:e=>{let t=e;return t.getIn(["styleConfig","useCustom"])&&t.getIn(["styleConfig","customStyle","regular","border","width"])&&(t=t.setIn(["styleConfig","customStyle","regular","border","width"],s.utils.stringOfLinearUnit(t.getIn(["styleConfig","customStyle","regular","border","width"])))),t.getIn(["styleConfig","useCustom"])&&t.getIn(["styleConfig","customStyle","hover","border","width"])&&(t=t.setIn(["styleConfig","customStyle","hover","border","width"],s.utils.stringOfLinearUnit(t.getIn(["styleConfig","customStyle","hover","border","width"])))),t}}]}}const r=new i;function p(e,i,o){const n=e?"default":"hover",r=(0,t.Immutable)(o),p=r.getIn(["components","button","variants",i,n,"color"]),l=r.getIn(["components","button","sizes","default","fontSize"]);return{color:p,size:parseFloat(s.styleUtils.remToPixel(l))}}var l;!function(e){e[e.None=0]="None",e[e.Main=1]="Main",e[e.Sub=2]="Sub"}(l||(l={}));class a extends t.React.PureComponent{constructor(i){var o,n,r,a,u;super(i),this.repeat=0,this.getTextFromProps=()=>{var e,t,i,o;return"string"==typeof(null===(t=null===(e=this.props.config)||void 0===e?void 0:e.functionConfig)||void 0===t?void 0:t.text)?null===(o=null===(i=this.props.config)||void 0===i?void 0:i.functionConfig)||void 0===o?void 0:o.text:this.props.intl.formatMessage({id:"variableButton",defaultMessage:s.defaultMessages.variableButton})},this.setRepeatType=()=>{const e=this.props.repeatedDataSource;let t;t=e?0===e.recordIndex?l.Main:l.Sub:l.None,this.repeat=t},this.getTipExpression=()=>{var e,s;return this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.toolTipExpression&&this.props.config.functionConfig.toolTipExpression||(0,t.Immutable)({name:"",parts:[{type:t.ExpressionPartType.String,exp:`"${(null===(s=null===(e=this.props.config)||void 0===e?void 0:e.functionConfig)||void 0===s?void 0:s.toolTip)||""}"`}]})},this.getTextExpression=()=>{var e,s;return this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.textExpression&&this.props.config.functionConfig.textExpression||(0,t.Immutable)({name:"",parts:[{type:t.ExpressionPartType.String,exp:`"${(null===(s=null===(e=this.props.config)||void 0===e?void 0:e.functionConfig)||void 0===s?void 0:s.text)||this.getTextFromProps()}"`}]})},this.getUrlExpression=()=>this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.linkParam&&this.props.config.functionConfig.linkParam&&this.props.config.functionConfig.linkParam.expression||null,this.onTextExpResolveChange=e=>{if(e.isSuccessful)this.setState({text:e.value});else{let s="";e.value===t.ExpressionResolverErrorCode.Failed&&(s=this.state.textExpression&&this.state.textExpression.name),this.setState({text:s})}},this.onTipExpResolveChange=e=>{if(e.isSuccessful)this.setState({toolTip:e.value});else{let s="";e.value===t.ExpressionResolverErrorCode.Failed&&(s=this.state.tipExpression&&this.state.tipExpression.name),this.setState({toolTip:s})}},this.onUrlExpResolveChange=e=>{if(e.isSuccessful)this.setState({url:e.value});else{let s="";e.value===t.ExpressionResolverErrorCode.Failed&&(s=this.state.urlExpression&&this.state.urlExpression.name),this.setState({url:s})}},this.showQuickStylePanel=()=>{if(!window.jimuConfig.isInBuilder)return!1;const e=this.repeat,{active:t}=this.props;return this.props.showQuickStyle&&t&&e!==l.Sub},this.getWhetherUseQuickStyle=e=>!!(e&&e.styleConfig&&e.styleConfig.themeStyle&&e.styleConfig.themeStyle.quickStyleType),this.getIconStyle=(e,i)=>{const o=e||{},n=i||{};return t.css`
      & img, & svg{
        color: ${o.color};
        fill: ${o.color};
        width: ${o.size}${s.DistanceUnits.PIXEL};
        height: ${o.size}${s.DistanceUnits.PIXEL};
      }
      &:hover{
        img, svg{
          color: ${n.color};
          fill: ${n.color};
          width: ${n.size}${s.DistanceUnits.PIXEL};
          height: ${n.size}${s.DistanceUnits.PIXEL};
        }
      }
    `},this.removeUndefinedStyle=e=>{if(!e)return e;const t={};return Object.keys(e).forEach((s=>{("string"==typeof e[s]&&e[s].indexOf("undefined")<0||"number"==typeof e[s])&&(t[s]=e[s])})),t},this.getLinkComponent=()=>{const i=this.props.config,o=i.functionConfig.linkParam,n=this.state.text,r=this.state.toolTip;let p,l;if(i.styleConfig&&i.styleConfig.customStyle){const e=i.styleConfig.customStyle.regular,o=i.styleConfig.customStyle.hover;if(i.styleConfig.useCustom){const i=s.styleUtils.toCSSStyle(e&&e.without("iconProps").asMutable({deep:!0})),n=s.styleUtils.toCSSStyle(o&&o.without("iconProps").asMutable({deep:!0}));if(this.props.active&&this.props.appMode!==t.AppMode.Run){const s=(0,t.getAppStore)().getState().widgetsState[this.props.id]||(0,t.Immutable)({});p={style:s.isConfiguringHover?Object.assign(Object.assign({},this.removeUndefinedStyle(i)),this.removeUndefinedStyle(n)):i,hoverStyle:n},l=this.getIconStyle(s.isConfiguringHover?Object.assign(Object.assign({},null==e?void 0:e.iconProps),null==o?void 0:o.iconProps):null==e?void 0:e.iconProps,null==o?void 0:o.iconProps)}else p={style:i,hoverStyle:n},l=this.getIconStyle(e&&e.iconProps,o&&o.iconProps)}}const a=this.getWhetherUseQuickStyle(i)?{type:i.styleConfig.themeStyle.quickStyleType}:null;let u,c,h;o&&o.linkType&&(c=o.openType,h={linkType:o.linkType},o.linkType===t.LinkType.WebAddress?h.value=this.state.url:(h.value=o.value,u=this.props.queryObject));const g=i.functionConfig.icon,d=this.props.isRTL,f=g&&(!g.position||g.position===e.Left)&&(0,t.jsx)(s.Icon,{icon:g.data,className:(0,t.classNames)({"mr-2 ml-0":!!n&&!d,"ml-2 mr-0":!!n&&d,"mx-0":!n})}),y=g&&g.position&&g.position===e.Right&&(0,t.jsx)(s.Icon,{icon:g.data,className:(0,t.classNames)({"ml-2 mr-0":!!n&&!d,"mr-2 ml-0":!!n&&d,"mx-0":!n})});return(0,t.jsx)(s.Link,{to:h,target:c,queryObject:u,title:r,className:"widget-button-link text-truncate w-100 h-100 p-0 d-flex align-items-center justify-content-center",role:(null==h?void 0:h.value)&&h.linkType!==t.LinkType.Dialog?"link":"button",customStyle:p,themeStyle:a,css:l},(0,t.jsx)("span",{className:"text-truncate widget-button-text"},d?y:f,n,d?f:y))},this.onQuickStyleChange=e=>{let{config:t}=this.props;const s=this.props.id,i=this.props.builderSupportModules,o=i&&i.jimuForBuilderLib.getAppConfigAction;o&&(t=t.setIn(["styleConfig","useCustom"],!1),t=t.setIn(["styleConfig","themeStyle","quickStyleType"],e),t=t.setIn(["styleConfig","customStyle","regular"],{iconProps:p(!0,e,this.props.theme)}),t=t.setIn(["styleConfig","customStyle","hover"],{iconProps:p(!1,e,this.props.theme)}),o().editWidgetProperty(s,"config",t).exec())},this.onClick=e=>{e.exbEventType="linkClick"},this.onQuickStyleClose=()=>this.props.dispatch(t.appActions.widgetStatePropChange(this.props.id,"showQuickStyle",!1)),this.getQuickStyleComponent=()=>{var e,s,i,o,n;const r=this.props.builderSupportModules&&this.props.builderSupportModules.widgetModules&&this.props.builderSupportModules.widgetModules.QuickStyle;return r?(0,t.jsx)(r,{onChange:this.onQuickStyleChange,reference:this.domNode&&this.domNode.current,onClose:this.onQuickStyleClose,selectedType:!(null===(s=null===(e=this.props.config)||void 0===e?void 0:e.styleConfig)||void 0===s?void 0:s.useCustom)&&(null===(n=null===(o=null===(i=this.props.config)||void 0===i?void 0:i.styleConfig)||void 0===o?void 0:o.themeStyle)||void 0===n?void 0:n.quickStyleType),onInitDragHandler:this.props.onInitDragHandler,onInitResizeHandler:this.props.onInitResizeHandler}):null},this.state={text:this.getTextFromProps(),toolTip:(null===(n=null===(o=this.props.config)||void 0===o?void 0:o.functionConfig)||void 0===n?void 0:n.toolTip)||"",url:(null===(u=null===(a=null===(r=this.props.config)||void 0===r?void 0:r.functionConfig)||void 0===a?void 0:a.linkParam)||void 0===u?void 0:u.value)||"",textExpression:this.props.useDataSourcesEnabled&&this.getTextExpression(),tipExpression:this.props.useDataSourcesEnabled&&this.getTipExpression(),urlExpression:this.props.useDataSourcesEnabled&&this.getUrlExpression(),mouted:!1},this.domNode=t.React.createRef()}componentDidMount(){window.jimuConfig.isInBuilder&&(this.setRepeatType(),this.props.active&&!this.props.hasEverMount&&this.props.dispatch(t.appActions.widgetStatePropChange(this.props.id,"showQuickStyle",!0)),this.props.hasEverMount||this.props.dispatch(t.appActions.widgetStatePropChange(this.props.id,"hasEverMount",!0)),this.setState({mouted:!0}))}componentDidUpdate(e,s){this.props.useDataSourcesEnabled||this.props.config===e.config&&!e.useDataSourcesEnabled||this.setState({text:this.getTextFromProps(),toolTip:this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.toolTip,url:this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.linkParam&&this.props.config.functionConfig.linkParam.value}),!this.props.useDataSourcesEnabled||this.props.config===e.config&&e.useDataSourcesEnabled||this.setState({textExpression:this.getTextExpression(),tipExpression:this.getTipExpression(),urlExpression:this.getUrlExpression()}),window.jimuConfig.isInBuilder&&(this.props.appMode!==e.appMode&&this.props.appMode===t.AppMode.Run||!this.props.active&&e.active)&&this.props.dispatch(t.appActions.widgetStatePropChange(this.props.id,"showQuickStyle",!1))}render(){const e=this.props.useDataSourcesEnabled,s=this.showQuickStylePanel(),i=this.getLinkComponent(),o=this.getQuickStyleComponent();return(0,t.jsx)("div",{className:"jimu-widget widget-button w-100 h-100",css:(this.props.theme,t.css`
    &>a {
      display: flex !important;
      justify-content: center;
    }

    .widget-button-text{
      line-height: initial;
    }

  `),ref:this.domNode,onClick:this.onClick,onTouchEnd:this.onClick},i,s&&o,(0,t.jsx)("div",{style:{display:"none"}},e&&(0,t.jsx)("div",null,(0,t.jsx)(t.ExpressionResolverComponent,{useDataSources:this.props.useDataSources,expression:this.state.textExpression,onChange:this.onTextExpResolveChange,widgetId:this.props.id}),(0,t.jsx)(t.ExpressionResolverComponent,{useDataSources:this.props.useDataSources,expression:this.state.tipExpression,onChange:this.onTipExpResolveChange,widgetId:this.props.id}),(0,t.jsx)(t.ExpressionResolverComponent,{useDataSources:this.props.useDataSources,expression:this.state.urlExpression,onChange:this.onUrlExpResolveChange,widgetId:this.props.id}))))}}a.mapExtraStateProps=(e,s)=>{let i=!1;const o=e.appRuntimeInfo.selection;if(o&&e.appConfig.layouts[o.layoutId]){const t=e.appConfig.layouts[o.layoutId].content[o.layoutItemId];i=t&&t.widgetId===s.id}const n=e.appContext.isInBuilder&&i,r=e.widgetsState[s.id]||(0,t.Immutable)({});return{active:n,showQuickStyle:!!r.showQuickStyle,appMode:n?e.appRuntimeInfo.appMode:null,queryObject:e.queryObject,hasEverMount:r.hasEverMount,isRTL:e.appContext.isRTL}},a.versionManager=r})(),n})())}}}));